# Установка Tutas Ai Mobile на телефон

## Требования

### Для Android
- Android 5.0 (API 21) или выше
- Включен режим разработчика
- Разрешение на установку из неизвестных источников

### Для iOS
- iOS 12.0 или выше
- Mac с Xcode (для сборки)
- Apple Developer аккаунт (для установки на физическое устройство)

## Способ 1: Установка APK (Android) - Рекомендуется

### Шаг 1: Сборка APK

```bash
cd mobile

# Установить зависимости
flutter pub get

# Собрать APK для релиза
flutter build apk --release

# Или собрать APK для разработки (меньше размер)
flutter build apk --debug
```

APK файл будет находиться в: `mobile/build/app/outputs/flutter-apk/app-release.apk`

### Шаг 2: Перенос APK на телефон

**Вариант A: Через USB**
```bash
# Подключите телефон через USB
# Включите режим отладки по USB в настройках разработчика

# Скопируйте APK на телефон
adb install build/app/outputs/flutter-apk/app-release.apk

# Или скопируйте файл вручную и установите через файловый менеджер
```

**Вариант B: Через облако/email**
1. Загрузите `app-release.apk` в Google Drive / Dropbox
2. Откройте на телефоне и скачайте
3. Установите через файловый менеджер

### Шаг 3: Установка на телефоне

1. Откройте файловый менеджер на телефоне
2. Найдите скачанный APK файл
3. Нажмите на него
4. Если появится предупреждение "Установка из неизвестных источников":
   - Нажмите "Настройки"
   - Включите "Разрешить из этого источника"
   - Вернитесь и нажмите "Установить"
5. После установки откройте приложение "Tutas Ai"

## Способ 2: Установка через USB (Разработка)

### Для Android

```bash
cd mobile

# Установить зависимости
flutter pub get

# Подключите телефон через USB
# Включите режим отладки по USB

# Запустить приложение
flutter run

# Или установить и запустить
flutter install
```

### Для iOS

**Быстрая установка:**
```bash
cd mobile
./install_ios.sh
```

**Или вручную:**

```bash
cd mobile

# 1. Установить зависимости
flutter pub get

# 2. Создать iOS проект (если не существует)
flutter create --platforms=ios .

# 3. Подключите iPhone через USB
#    На iPhone: нажмите "Доверять этому компьютеру"

# 4. Настройте для физического устройства (важно!)
#    Обновите IP-адрес API в lib/repositories/defect_repository.dart
#    Или используйте переменную окружения:
flutter run --dart-define=API_BASE_URL=http://192.168.8.108:8000

# 5. Или откройте в Xcode для более детальной настройки
open ios/Runner.xcworkspace
```

**Важно для физического iPhone:**
- Используйте IP-адрес вашего компьютера вместо `localhost`
- Убедитесь, что iPhone и компьютер в одной Wi-Fi сети
- На iPhone включите "Режим разработчика" (Настройки > Конфиденциальность > Режим разработчика)

## Способ 3: Установка через Android Studio / Xcode

### Android Studio

1. Откройте проект в Android Studio
2. Выберите устройство в верхней панели
3. Нажмите кнопку "Run" (▶️)
4. Приложение установится и запустится на телефоне

### Xcode (iOS)

1. Откройте `mobile/ios/Runner.xcworkspace` в Xcode
2. Выберите ваше устройство в списке устройств
3. Нажмите кнопку "Run" (▶️)
4. Приложение установится и запустится на iPhone

## Настройка API endpoint

Перед установкой убедитесь, что приложение настроено на правильный API endpoint.

Откройте `mobile/lib/data/api/api_client.dart` и проверьте базовый URL:

```dart
static const String baseUrl = 'http://api.localhost';  // Для эмулятора
// Или
static const String baseUrl = 'http://192.168.1.100:8000';  // Для физического устройства
```

**Важно для физического устройства:**
- Используйте IP-адрес вашего компьютера вместо `localhost`
- Убедитесь, что телефон и компьютер в одной Wi-Fi сети
- Или используйте `10.0.2.2` для Android эмулятора

### Как узнать IP-адрес компьютера:

**macOS/Linux:**
```bash
ifconfig | grep "inet " | grep -v 127.0.0.1
```

**Windows:**
```cmd
ipconfig
```

Найдите IP-адрес в локальной сети (обычно начинается с `192.168.` или `10.0.`)

## Разрешения

Приложение запрашивает следующие разрешения:

### Android
- **Камера**: Для сканирования QR-кодов и фотографирования дефектов
- **Хранилище**: Для сохранения фотографий дефектов
- **Интернет**: Для синхронизации данных с сервером

Разрешения запрашиваются автоматически при первом использовании функции.

### iOS
- **Камера**: Для сканирования QR-кодов и фотографирования дефектов
- **Фото**: Для доступа к галерее фотографий

## Проверка установки

После установки:

1. Откройте приложение "Tutas Ai"
2. Нажмите "Scan QR-code"
3. Отсканируйте QR-код трубы (формат: `PL-{COMPANY}-{UUID}`)
4. Проверьте, что данные трубы загружаются
5. Попробуйте добавить дефект с фотографией

## Устранение проблем

### "Не удается подключиться к серверу"

1. Проверьте, что backend запущен: `make up` или `docker-compose up`
2. Проверьте IP-адрес в `api_client.dart`
3. Убедитесь, что телефон и компьютер в одной сети
4. Проверьте, что порт 8000 открыт в firewall

### "Приложение не устанавливается"

**Android:**
- Включите "Установка из неизвестных источников" в настройках
- Проверьте, что APK не поврежден (пересоберите)

**iOS:**
- Убедитесь, что у вас есть Apple Developer аккаунт
- Проверьте подпись приложения в Xcode

### "Камера не работает"

1. Предоставьте разрешение на использование камеры
2. Перезапустите приложение
3. Проверьте настройки разрешений в настройках телефона

## Быстрая установка (одна команда)

```bash
# Android
cd mobile && flutter pub get && flutter build apk --release && adb install build/app/outputs/flutter-apk/app-release.apk

# iOS (требует Mac и Xcode)
cd mobile && flutter pub get && flutter build ios && flutter install
```

## Обновление приложения

Для обновления установленного приложения:

1. Соберите новую версию APK/IPA
2. Установите поверх старой версии (данные сохранятся)
3. Или удалите старое приложение и установите новое

```bash
# Android
flutter build apk --release
adb install -r build/app/outputs/flutter-apk/app-release.apk

# iOS
flutter build ios
flutter install
```
